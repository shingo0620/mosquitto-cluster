version: "3"
networks:
  mqtt:
services:
  master:
    image: eclipse-mosquitto
    expose:
      - "1883"
    volumes:
      - "./config/mosquitto-master.conf:/mosquitto/config/mosquitto.conf"
      - "./data:/mosquitto/data"
      - "./log:/mosquitto/log"
    networks:
      - mqtt
    depends_on:
      - slave
    
  slave:
    image: eclipse-mosquitto
    expose:
      - "1883"
    volumes:
      - "./data:/mosquitto/data"
      - "./log:/mosquitto/log"
    networks:
      - mqtt
  
  subscribe_master:
    build:
      context: ./
      dockerfile: ./Dockerfile-subscriber
    environment:
      - HOST=master
    networks:
      - mqtt
    depends_on:
      - master
      - slave

  subscribe_slave:
    build:
      context: ./
      dockerfile: ./Dockerfile-subscriber
    environment:
      - HOST=slave
    networks:
      - mqtt
    depends_on:
      - master
      - slave